<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <!--
        See http://www.liquibase.org/manual/home#available_database_refactorings
        for a list of supported elements and attributes
    -->
    <changeSet id="bahmni-1" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_10__CreatingPatientIdentifierForBahmni.sql"/>
    </changeSet>
    <changeSet id="bahmni-2" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_23__DeleteOpenMRSCorePersonAttributes.sql"/>
    </changeSet>
    <changeSet id="bahmni-3" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_24__AddUniqueConstraintToPatientidentifier.sql"/>
    </changeSet>
    <changeSet id="bahmni-4" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile splitStatements="false" path="V1_29__AddConceptProc.sql"/>
    </changeSet>
    <changeSet id="bahmni-5" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile splitStatements="false" path="V1_30__AddConceptAnswerProc.sql"/>
    </changeSet>
    <changeSet id="bahmni-6" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile splitStatements="false" path="V1_31__AddConceptWordProc.sql"/>
    </changeSet>
    <changeSet id="bahmni-7" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile splitStatements="false" path="V1_37__SetValueAsConceptIdProc.sql"/>
    </changeSet>
    <changeSet id="bahmni-clinical-1" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_39__CreateLaboratoryPanelConcept.sql"/>
    </changeSet>
    <changeSet id="bahmni-9" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_40__AddingConceptWordForLaboratoryConcept.sql"/>
    </changeSet>
    <changeSet id="bahmni-10" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_41__AddingIndexToCityVillage-JssSpecific.sql"/>
    </changeSet>
    <changeSet id="bahmni-11" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_42__RemovingNotNullContraintOnOrderTypeId.sql"/>
    </changeSet>
    <changeSet id="bahmni-12" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_43__AddOPDConsultationEncounterType.sql"/>
    </changeSet>
    <changeSet id="bahmni-31" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_10__SetupRegistrationEncounterType.sql"/>
    </changeSet>
    <changeSet id="bahmni-16" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_55__addLabAndRadiologyOrderTypes.sql"/>
    </changeSet>
    <changeSet id="bahmni-17" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile splitStatements="false" path="V1_56__AddConceptDescriptionProc.sql"/>
    </changeSet>
    <changeSet id="bahmni-clinical-2" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_57__addDrugDosageInstructionsAndDosageFrequecies.sql"/>
    </changeSet>
    <changeSet id="bahmni-19" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile splitStatements="false" path="V1_58__AddConceptReferenceMapProc.sql"/>
    </changeSet>
    <changeSet id="bahmni-20" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile splitStatements="false" path="V1_59__AddConceptSetMembersProc.sql"/>
    </changeSet>
    <changeSet id="bahmni-clinical-3" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_60__AddDiagnosisConcepts.sql"/>
    </changeSet>
    <changeSet id="bahmni-clinical-4" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_62__AddDispositionConcepts.sql"/>
    </changeSet>
    <changeSet id="bahmni-clinical-5" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_66__addConceptConsultationNote.sql"/>
    </changeSet>
    <changeSet id="bahmni-25" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_67__AddConceptSetForAdmission.sql"/>
    </changeSet>
    <changeSet id="bahmni-26" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_68__EncounterTypeForAdmission.sql"/>
    </changeSet>
    <changeSet id="bahmni-27" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_69__AddConceptSetForDischarge.sql"/>
    </changeSet>
    <changeSet id="bahmni-28" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_70__EncounterTypeForDischarge.sql"/>
    </changeSet>
    <changeSet id="bahmni-29" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile splitStatements="false" path="V1_72__AddProcToInsertNewAddressLevel.sql"/>
    </changeSet>
    <changeSet id="bahmni-30" author="tw" context="rel3">
        <comment>rel3</comment>
        <update tableName="patient_identifier_type">
            <column name="name" value="Bahmni Id"/>
            <where>name='JSS'</where>
        </update>
    </changeSet>
    <changeSet id="bahmni-32" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_78__EncounterTypeForTransfer.sql"/>
    </changeSet>
    <changeSet id="bahmni-33" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_71__PatientSearchSql.sql"/>
    </changeSet>
    <changeSet id="bahmni-34" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_77__PatientSearchSqlAllAdmittedPatients.sql"/>
    </changeSet>
    <changeSet id="bahmni-35" author="tw" context="rel3">
        <preConditions onFail="HALT">
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM global_property where property = 'emr.primaryIdentifierType'
            </sqlCheck>
        </preConditions>
        <comment>rel3</comment>
        <sqlFile path="V1_61__CreatingGlobalPropertyForPatientIdentifierType.sql"/>
    </changeSet>
    <changeSet id="bahmni-36" author="tw" context="rel3">
        <comment>Add investigations meta data</comment>
        <sql>
            set @concept_id = 0;
            set @answer_concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Lab Departments', 'Lab departments', 'N/A', 'ConvSet', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'LAB', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'DEPARTMENTS', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'LAB', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'DEPARTMENTS', '1');


            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Other Investigations', 'Other Investigations', 'N/A', 'ConvSet', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'OTHER', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'INVESTIGATIONS', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'OTHER', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'INVESTIGATIONS', '1');


            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Other Investigations Categories', 'Other Investigations Categories', 'N/A', 'ConvSet', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'OTHER', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'INVESTIGATIONS', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'CATEGORIES', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'OTHER', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'INVESTIGATIONS', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'CATEGORIES', '1');
        </sql>
    </changeSet>

    <changeSet id="bahmni-clinical-6" author="Hemanth" context="rel3">
        <comment>Add concept Adt Notes</comment>
        <sql>
            insert into concept (retired, short_name, description, datatype_id, class_id, is_set, creator, date_created,
            changed_by, date_changed, uuid)
            values (0, 'Adt Notes', 'Adt Notes',
            (select concept_datatype_id from concept_datatype where name = 'Text'),
            (select concept_class_id from concept_class where name = 'Misc'),
            0, 1, now(), 1, now(), uuid());
        </sql>
    </changeSet>

    <changeSet id="bahmni-clinical-7" author="Hemanth" context="rel3">
        <comment>Add concept-name Adt Notes</comment>
        <sql>
            insert into concept_name (concept_id, name, locale, locale_preferred, creator, date_created,
            concept_name_type, voided, uuid)
            values ((select concept_id from concept where short_name='Adt Notes'),
            'Adt Notes', 'en', 1, 1, now(), 'FULLY_SPECIFIED', 0, uuid());
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-8" author="Praveen" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM global_property where property = 'bahmni.encountersession.duration'
            </sqlCheck>
        </preConditions>
        <comment>Add encounter session duration</comment>
        <sql>
            insert into global_property (`property`, `property_value`, `description`, `uuid`)
            values ('bahmni.encountersession.duration',
            '60',
            'Encountersession duration in minutes',
            uuid()
            );
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-9" author="Praveen" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM global_property where property = 'emr.encounterMatcher'
            </sqlCheck>
        </preConditions>
        <comment>Add custom encounter session matcher</comment>
        <sql>
            insert into global_property (`property`, `property_value`, `description`, `uuid`)
            values ('emr.encounterMatcher',
            'org.bahmni.module.bahmnicore.matcher.EncounterSessionMatcher',
            'custom encounter session matcher',
            uuid()
            );
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-10" author="Vivek" context="rel3">
        <comment>Add concept words for adt notes</comment>
        <sql>
            select concept_id INTO @concept_id from concept where short_name='Adt Notes';
            select concept_name_id INTO @concept_name_full_id from concept_name where concept_id = (select concept_id from concept where short_name='Adt Notes');

            call add_concept_word(@concept_id, @concept_name_full_id, 'Adt', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'Notes', '1');
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-11" author="Arathy" context="rel3">
        <comment>Add concept Document</comment>
        <sql>
            insert into concept (retired, short_name, description, datatype_id, class_id, is_set, creator, date_created,
            changed_by, date_changed, uuid)
            values (0, 'Document', 'Document',
            (select concept_datatype_id from concept_datatype where name = 'Text'),
            (select concept_class_id from concept_class where name = 'Misc'),
            0, 1, now(), 1, now(), uuid());
        </sql>
    </changeSet>

    <changeSet id="bahmni-clinical-12" author="Arathy" context="rel3">
        <comment>Add concept-name Document</comment>
        <sql>
            insert into concept_name (concept_id, name, locale, locale_preferred, creator, date_created,
            concept_name_type, voided, uuid)
            values ((select concept_id from concept where short_name='Document'),
            'Document', 'en', 1, 1, now(), 'FULLY_SPECIFIED', 0, uuid());
        </sql>
    </changeSet>

    <changeSet id="bahmni-clinical-13" author="Arathy" context="rel3">
        <comment>Add Encounter Type Radiology</comment>
        <sql>
            insert into encounter_type (name, description, creator, date_created, uuid)
            VALUES ('RADIOLOGY', 'RADIOLOGY encounter', 1, curdate(), uuid());
        </sql>
    </changeSet>

    <changeSet id="bahmni-clinical-201401171353" author="banka-tw" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from privilege where privilege = 'app:clinical'</sqlCheck>
        </preConditions>
        <insert tableName="privilege">
            <column name="privilege" value="app:clinical"/>
            <column name="description" value="Bahmni clinical app access privilege"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>

    <changeSet id="bahmni-clinical-201401171415" author="banka-tw" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from privilege where privilege = 'app:radiologyOrders'</sqlCheck>
        </preConditions>
        <insert tableName="privilege">
            <column name="privilege" value="app:radiologyOrders"/>
            <column name="description" value="Bahmni radiology orders access privilege"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>

    <changeSet id="bahmni-clinical-201401171420" author="banka-tw" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from privilege where privilege = 'app:documents'</sqlCheck>
        </preConditions>
        <insert tableName="privilege">
            <column name="privilege" value="app:documents"/>
            <column name="description" value="Privilege to access the documents scanning app"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>
    <changeSet id="bahmni-clinical-14" author="Praveen" context="rel3">
        <comment>Add new encounter type for investigation</comment>
        <sql>
            INSERT INTO encounter_type (name, description, creator, date_created, uuid) VALUES ('INVESTIGATION', 'Investigation encounter', 1, curdate(), uuid());
        </sql>
    </changeSet>
    <changeSet id="bahmni-37" author="tw" context="rel3">
        <comment>Add job for processing reference data</comment>
        <sql>
            INSERT INTO scheduler_task_config(name, schedulable_class, start_time, start_time_pattern, repeat_interval,start_on_startup, started, created_by, date_created, uuid)
            VALUES ('Reference Data Task', 'org.bahmni.module.referncedatafeedclient.task.ReferenceDataFeedTask', now(),'MM/dd/yyyy HH:mm:ss', 60, 1, 0, 1, curdate(), uuid());
        </sql>
    </changeSet>
    <changeSet id="bahmni-38" author="tw" context="rel3">
        <comment>Add job for processing failed reference data</comment>
        <sql>
            INSERT INTO scheduler_task_config(name, schedulable_class, start_time, start_time_pattern, repeat_interval,start_on_startup, started, created_by, date_created, uuid)
            VALUES ('Reference Data Failed Event Task', 'org.bahmni.module.referncedatafeedclient.task.ReferenceDataFailedEventTask', now(),'MM/dd/yyyy HH:mm:ss', 60, 1, 0, 1, curdate(), uuid());
        </sql>
    </changeSet>
    <changeSet id="bahmni-39" author="tw" context="rel3">
        <comment>Update class name of reference data feed task and failed event task.</comment>
        <sql>
            UPDATE scheduler_task_config SET schedulable_class = 'org.bahmni.module.referencedatafeedclient.task.ReferenceDataFeedTask' WHERE name = 'Reference Data Task';
            UPDATE scheduler_task_config SET schedulable_class = 'org.bahmni.module.referencedatafeedclient.task.ReferenceDataFailedEventTask' WHERE name = 'Reference Data Failed Event Task';
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201401281730" author="Banka,RT" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from encounter_type where name = 'LAB_RESULT'</sqlCheck>
        </preConditions>
        <comment>Add new encounter type for Lab Result</comment>
        <sql>
            INSERT INTO encounter_type (name, description, creator, date_created, uuid) VALUES ('LAB_RESULT', 'Lab Result encounter', 1, curdate(), uuid());
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201401311600" author="TW" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from concept_name where name = 'LAB_RESULTS_CONCEPT_SET'
            </sqlCheck>
        </preConditions>
        <comment>Add concept set for Lab results</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            set @answer_concept_id = 0;
            call add_concept(@concept_id, @concept_name_short_id,
            @concept_name_full_id,'LABRESULTS_CONCEPT','LABRESULTS_CONCEPT', 'N/A', 'Finding', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'LABRESULTS', 1);

            set @labresults_concept_id = @concept_id;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id,'LAB_RESULT','LAB_RESULT',
            'Text', 'Finding', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'LAB', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'RESULT', 1);
            set @set_concept_id = @concept_id;
            call add_concept_set_members (@labresults_concept_id,@set_concept_id,1);


            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id,'LAB_NOTES','LAB_NOTES', 'Text',
            'Finding', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'LAB', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'NOTES', 1);
            set @set_concept_id = @concept_id;
            call add_concept_set_members (@labresults_concept_id,@set_concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id,'LAB_MINNORMAL','LAB_MINNORMAL',
            'Numeric', 'Finding', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'LAB', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'MINNORMAL', 1);
            set @set_concept_id = @concept_id;
            call add_concept_set_members (@labresults_concept_id,@set_concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id,'LAB_MAXNORMAL','LAB_MAXNORMAL',
            'Numeric', 'Finding', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'LAB', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'MAXNORMAL', 1);
            set @set_concept_id = @concept_id;
            call add_concept_set_members (@labresults_concept_id,@set_concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id,'LAB_ABNORMAL','LAB_ABNORMAL',
            'Boolean', 'Finding', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'LAB', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'ABNORMAL', 1);
            set @set_concept_id = @concept_id;
            call add_concept_set_members (@labresults_concept_id,@set_concept_id,1);
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201402061215" author="Angshu,RT" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from visit_type where name = 'LAB_RESULTS_IN_ABSENTEE'</sqlCheck>
        </preConditions>
        <comment>Add new visit type LAB_RESULTS_IN_ABSENTEE</comment>
        <sql>
            INSERT INTO visit_type (name, description, creator, uuid, date_created) VALUES ('LAB_RESULTS_IN_ABSENTEE', 'Visit for which results come when patient is not present', 1, uuid(), curdate());
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201402101443" author="sush" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from privilege where privilege = 'app:document-upload'</sqlCheck>
        </preConditions>
        <insert tableName="privilege">
            <column name="privilege" value="app:document-upload"/>
            <column name="description" value="bahmni document upload access privilege"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>
    <changeSet id="bahmni-clinical-201402111716" author="indraneel,neha" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from privilege where privilege = 'app:adt'</sqlCheck>
        </preConditions>
        <insert tableName="privilege">
            <column name="privilege" value="app:adt"/>
            <column name="description" value="bahmni adt access privilege"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>
    <changeSet id="bahmni-clinical-201402161951" author="Mujir,Vinay" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from visit_type where name = 'DRUG_ORDER'</sqlCheck>
        </preConditions>
        <comment>Creating new visit type DRUG_ORDER</comment>
        <sql>
            INSERT INTO visit_type (name, description, creator, uuid, date_created) VALUES ('DRUG_ORDER', 'Placeholder visit for orders created when no visit is open', 1, uuid(), curdate());
        </sql>
    </changeSet>

    <changeSet id="bahmni-clinical-201402201226" author="Neha,Indraneel" context="rel3">
        <comment>deleting visit types DRUG_ORDER and LAB_RESULTS_IN_ABSENTEE</comment>
        <sql>
            DELETE from visit_type where name in ('DRUG_ORDER','LAB_RESULTS_IN_ABSENTEE');
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201402201520" author="Angshu" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from global_property where property = 'emr.primaryIdentifierType'</sqlCheck>
        </preConditions>
        <comment>Add global property for emr primary identifier type</comment>
        <sql>
            INSERT INTO global_property (property, uuid, description) values ('emr.primaryIdentifierType', UUID(), 'Primary identifier type for looking up patients, generating barcodes, etc') ON DUPLICATE KEY UPDATE description = 'Primary identifier type for looking up patients, generating barcodes, etc';
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201402201530" author="Angshu" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">select count(*) from patient_identifier_type where name = 'Bahmni Id'</sqlCheck>
        </preConditions>
        <comment>set global property value for emr primary identifier type</comment>
        <sql>
            update global_property set property_value = (select uuid from patient_identifier_type where name = 'Bahmni Id') where property = 'emr.primaryIdentifierType';
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201402201700" author="D3" context="rel3">
        <comment>Remove unused app:documents privilege</comment>
        <sql>
            DELETE from role_privilege where privilege = 'app:documents';
            DELETE from privilege where privilege = 'app:documents';
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201402251700" author="Mihir,Vinay">
        <comment>Add new concept to mark referred out tests</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;
            set @labresults_concept_id = 0;

            set @answer_concept_id = 0;
            call add_concept(@concept_id, @concept_name_short_id,
            @concept_name_full_id,'REFERRED_OUT','REFERRED_OUT', 'N/A', 'Misc', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'REFERRED', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'OUT', 1);
            select @labresults_concept_id := concept_id, min(concept_id) from concept_name where name = 'LABRESULTS_CONCEPT';
            set @set_concept_id = @concept_id;
            call add_concept_set_members (@labresults_concept_id,@set_concept_id,1);

        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201402281633" author="Indraneel,Neha" context="rel4">
        <comment>Add concept Lab Order Notes</comment>
        <sql>
            insert into concept (retired, short_name, description, datatype_id, class_id, is_set, creator, date_created,
            changed_by, date_changed, uuid)
            values (0, 'Lab Order Notes', 'Lab Order Notes',
            (select concept_datatype_id from concept_datatype where name = 'Text'),
            (select concept_class_id from concept_class where name = 'Misc'),
            0, 1, now(), 1, now(), uuid());
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201402281635" author="Indraneel,Neha" context="rel4">
        <comment>Add concept-name Lab Order Notes</comment>
        <sql>
            insert into concept_name (concept_id, name, locale, locale_preferred, creator, date_created,
            concept_name_type, voided, uuid)
            values ((select concept_id from concept where short_name='Document'),
            'Lab Order Notes', 'en', 1, 1, now(), 'FULLY_SPECIFIED', 0, uuid());
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201403051245" author="Neha" context="rel4">
        <comment>Delete concept Lab Order Notes</comment>
        <sql>
            DELETE from concept where short_name = 'Lab Order Notes';
            DELETE from concept_name where name = 'Lab Order Notes';
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201403051246" author="Neha">
        <comment>Add new concept to lab order notes</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            set @answer_concept_id = 0;
            call add_concept(@concept_id, @concept_name_short_id,
            @concept_name_full_id,'Lab Order Notes','Lab Order Notes', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'LAB', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'ORDER', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'NOTES', 1);
            set @set_concept_id = @concept_id;
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201403110603" author="Hemanth">
        <comment>Add new concept for test and panel</comment>
        <sql>
            insert into concept(datatype_id, class_id, is_set, creator, date_created, uuid) values(4, 10, true, 1, now(), uuid());

            select max(concept_id) from concept into @laboratory_concept_id;

            insert into concept_name(concept_id, name, locale, locale_preferred,creator, date_created, concept_name_type, uuid) values (@laboratory_concept_id, 'All_Tests_and_Panels', 'en', true, 1, now(), 'FULLY_SPECIFIED', uuid());
            insert into concept_name(concept_id, name, locale, locale_preferred,creator, date_created, concept_name_type, uuid) values (@laboratory_concept_id, 'A_T_and_P', 'en', false, 1, now(), 'SHORT', uuid());
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201403181515" author="Hemanth,Vinay">
        <comment>Add new concept for observation group (XCompoundObservation)</comment>
        <sql>
            insert into concept(datatype_id, class_id, is_set, creator, date_created, uuid) values(4, 10, true, 1, now(), uuid());

            select max(concept_id) from concept into @compound_observation_id;

            insert into concept_name(concept_id, name, locale, locale_preferred,creator, date_created, concept_name_type, uuid) values (@compound_observation_id, 'XCompoundObservation', 'en', true, 1, now(), 'FULLY_SPECIFIED', uuid());

            insert into concept(datatype_id, class_id, is_set, creator, date_created, uuid) values(4, 10, true, 1, now(), uuid());
            select max(concept_id) from concept into @abnormal_id;

            insert into concept_name(concept_id, name, locale, locale_preferred,creator, date_created, concept_name_type, uuid) values (@abnormal_id, 'IS_ABNORMAL', 'en', true, 1, now(), 'FULLY_SPECIFIED', uuid());

            call add_concept_set_members (@compound_observation_id, @abnormal_id,1);

        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201403191516" author="tw">
        <comment>Changing admitted patient search query</comment>
        <sqlFile path="V1_79__PatientSearchSqlAllAdmittedPatients.sql"/>
    </changeSet>
    <changeSet id="bahmni-core-201403191725" author="Hemanth,Vinay">
        <comment>Add new concept for observation group (XCompoundObservation)</comment>
        <sql>
            update concept set datatype_id = (select concept_datatype_id from concept_datatype where name = 'Boolean'), class_id = (select concept_class_id from concept_class where name = 'Finding'), is_set = 0 where concept_id = (select concept_id from concept_name where name = 'IS_ABNORMAL' and concept_name_type='FULLY_SPECIFIED');
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201403251424" author="Mujir">
        <comment>Add new concept for Ruled Out Diagnosis</comment>
        <sql>
            set @concept_id = 0;
            set @answer_concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Ruled Out Diagnosis', 'Ruled Out Diagnosis', 'N/A', 'Misc', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'RULED OUT DIAGNOSIS', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'DIAGNOSIS', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'RULED', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'RULED OUT DIAGNOSIS', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'DIAGNOSIS', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'RULED', '1');
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201404021353" author="Hemanth, Mihir" context="rel4">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM person_attribute_type where name = 'givenNameLocal';
            </sqlCheck>
        </preConditions>
        <comment>adding givenNameLocal person attribute type</comment>
        <sql>
            INSERT INTO person_attribute_type (name, description, format, searchable, creator, date_created, retired, sort_weight, uuid) VALUES ('givenNameLocal', 'givenNameLocal', 'java.lang.String', '0', 1, now(), 0, 3, uuid());
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201404021359" author="Hemanth, Mihir" context="rel4">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM person_attribute_type where name = 'familyNameLocal';
            </sqlCheck>
        </preConditions>
        <comment>adding familyNameLocal person attribute type</comment>
        <sql>
            INSERT INTO person_attribute_type (name, description, format, searchable, creator, date_created, retired, sort_weight, uuid) VALUES ('familyNameLocal', 'familyNameLocal', 'java.lang.String', '0', 1, now(), 0, 3, uuid());
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201404021400" author="Hemanth, Mihir" context="rel4">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM person_attribute_type where name = 'middleNameLocal';
            </sqlCheck>
        </preConditions>
        <comment>adding middleNameLocal person attribute type</comment>
        <sql>
            INSERT INTO person_attribute_type (name, description, format, searchable, creator, date_created, retired, sort_weight, uuid) VALUES ('middleNameLocal', 'middleNameLocal', 'java.lang.String', '0', 1, now(), 0, 3, uuid());
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201404091217" author="sushmitharaos, arathyjan" context="rel4">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM encounter_type where name = 'Patient Document';
            </sqlCheck>
        </preConditions>
        <comment>add encounter type for patient document upload</comment>
        <insert tableName="encounter_type">
            <column name="name" value="Patient Document"/>
            <column name="description" value="Patient Document Encounter Type"/>
            <column name="creator" value="1"/>
            <column name="date_created" valueComputed="curdate()"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>
    <changeSet id="bahmni-core-201404081624" author="Vivek, Shruthi">
        <comment>Adding diagnosis meta data concepts</comment>
        <sql>
            set @concept_id = 0;
            set @answer_concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Bahmni Diagnosis Status', 'Bahmni Diagnosis Status', 'Coded', 'Misc', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'BAHMNI DIAGNOSIS STATUS', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'DIAGNOSIS', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'BAHMNI', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'STATUS', '1');

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Bahmni Initial Diagnosis', 'Bahmni Initial Diagnosis', 'Text', 'Misc', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'BAHMNI INITIAL DIAGNOSIS', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'DIAGNOSIS', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'BAHMNI', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'INITIAL', '1');

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Bahmni Diagnosis Revised', 'Bahmni Diagnosis Revised', 'Boolean', 'Misc', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'BAHMNI DIAGNOSIS REVISED', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'DIAGNOSIS', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'BAHMNI', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'REVISED', '1');
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201404081612" author="Indraneel, Mihir" context="rel4">
        <comment>Adding Lab Manager Notes Concept</comment>
        <sql>
            set @concept_id = 0;
            set @answer_concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Lab Manager Notes', 'Lab Manager Notes', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'LAB MANAGER NOTES', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'LAB', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'MANAGER', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'NOTES', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'LAB MANAGER NOTES', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'LAB', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'MANAGER', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'NOTES', '1');
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201404081625" author="Indraneel, Mihir" context="rel4">
        <comment>Adding Lab Manager Notes Provider</comment>
        <sql>
            set @puuid = uuid();

            insert into person(birthdate_estimated, dead, creator, date_created, uuid)
            values(0, 0, 1, now(), @puuid);

            insert into users(system_id, creator, date_created, person_id, uuid, username)
            values ('Lab Manager', 1, now(),(select person_id from person where uuid = @puuid) , uuid(), 'Lab Manager');

            insert into provider (person_id, identifier, creator, date_created, uuid, name) values ((select person_id from person where uuid = @puuid), 'LABMANAGER', 1, now(), uuid(), 'Lab Manager');</sql>
    </changeSet>
    <changeSet id="bahmni-core-201404101558" author="Indraneel, Neha" context="rel4">
        <comment>Adding Accession Uuid Concept</comment>
        <sql>
            set @concept_id = 0;
            set @answer_concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Accession Uuid', 'Accession Uuid', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'ACCESSION UUID', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'ACCESSION', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'UUID', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'ACCESSION UUID', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'ACCESSION', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'UUID', '1');
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201404101600" author="Neha,Indraneel" context="rel4">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM encounter_type where name = 'VALIDATION NOTES';
            </sqlCheck>
        </preConditions>
        <comment>Add Encounter Type Validation Notes</comment>
        <sql>
            insert into encounter_type (name, description, creator, date_created, uuid)
            VALUES ('VALIDATION NOTES', 'Validation Notes encounter', 1, curdate(), uuid());
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201404211500" author="RT, Shruthi">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM concept_class where name = 'Concept Attribute';
            </sqlCheck>
        </preConditions>
        <comment>add concept class Concept Attribute</comment>
        <insert tableName="concept_class">
            <column name="name" value="Concept Attribute"/>
            <column name="description" value="Concept Attribute class"/>
            <column name="creator" value="1"/>
            <column name="date_created" valueComputed="curdate()"/>
            <column name="retired" value="0"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>
    <changeSet id="bahmni-core-201404281212" author="RT, Neha">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) != 0 FROM concept WHERE datatype_id = 1 AND concept_id NOT IN (SELECT concept_id FROM concept_numeric);
            </sqlCheck>
        </preConditions>
        <comment>add concept numeric feild to all numeric concepts</comment>
        <sql>
            INSERT INTO concept_numeric (concept_id) (SELECT concept_id FROM concept WHERE
            datatype_id  = (SELECT concept_datatype_id FROM concept_datatype WHERE name = 'Numeric')
            AND concept_id NOT IN (SELECT concept_id FROM concept_numeric));
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201404281819" author="RT, Mujir">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM concept_class where name = 'Abnormal';
            </sqlCheck>
        </preConditions>
        <comment>add concept class Abnormal</comment>
        <insert tableName="concept_class">
            <column name="name" value="Abnormal"/>
            <column name="description" value="Abnormal class"/>
            <column name="creator" value="1"/>
            <column name="date_created" valueComputed="curdate()"/>
            <column name="retired" value="0"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>
    <changeSet id="bahmni-core-201404281820" author="RT, Mujir">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM concept_class where name = 'Duration';
            </sqlCheck>
        </preConditions>
        <comment>add concept class Duration</comment>
        <insert tableName="concept_class">
            <column name="name" value="Duration"/>
            <column name="description" value="Duration class"/>
            <column name="creator" value="1"/>
            <column name="date_created" valueComputed="curdate()"/>
            <column name="retired" value="0"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>
    <changeSet id="bahmni-core-201404281823" author="RT, Mujir">
        <comment>add concept numeric proc</comment>
        <sqlFile splitStatements="false" path="V1_80__AddConceptNumericProc.sql"/>
    </changeSet>
    <changeSet id="bahmni-core-201404281825" author="RT, Mujir">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM concept_class where name = 'Concept Details';
            </sqlCheck>
        </preConditions>
        <comment>add concept class Concept Details</comment>
        <insert tableName="concept_class">
            <column name="name" value="Concept Details"/>
            <column name="description" value="Concept Details class"/>
            <column name="creator" value="1"/>
            <column name="date_created" valueComputed="curdate()"/>
            <column name="retired" value="0"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>
    <changeSet id="bahmni-core-201404301204" author="RT, Mujir">
        <comment>delete Concept Proc</comment>
        <sqlFile splitStatements="false" path="V1_81__DeleteConcept.sql"/>
    </changeSet>
    <changeSet id="bahmni-core-201404301520" author="D3">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="2">select count(*) from global_property where property in ('emr.exitFromInpatientEncounterType', 'emr.admissionEncounterType')</sqlCheck>
        </preConditions>
        <comment>Configure EMR API admit and discharge encounter type</comment>
        <sql>
            UPDATE global_property SET property_value = (Select uuid from encounter_type where name = 'ADMISSION') where property = 'emr.admissionEncounterType';
            UPDATE global_property SET property_value = (Select uuid from encounter_type where name = 'DISCHARGE') where property = 'emr.exitFromInpatientEncounterType';
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201405041511" author="Mujir">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM concept_class where name = 'Duration';
            </sqlCheck>
        </preConditions>
        <comment>add concept class Duration</comment>
        <insert tableName="concept_class">
            <column name="name" value="Duration"/>
            <column name="description" value="Duration class"/>
            <column name="creator" value="1"/>
            <column name="date_created" valueComputed="curdate()"/>
            <column name="retired" value="0"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>
    <changeSet id="bahmni-core-201405061428" author="vinay">
        <comment>Fix delete_concept</comment>
        <sql>DROP PROCEDURE IF EXISTS delete_concept;</sql>
        <sql  splitStatements="false" stripComments="false">
            <![CDATA[
            CREATE  PROCEDURE delete_concept (name_concept VARCHAR(255))
            BEGIN
            DECLARE conceptId INT default 0;
                select concept_id INTO conceptId from concept_name where name = name_concept and locale_preferred = 1;
                delete from concept_set where concept_set = conceptId;
                delete from concept_word where concept_id = conceptId;
                delete from concept_name where concept_id = conceptId;
                delete from concept_numeric where concept_id = conceptId;
                delete from concept_answer where concept_id = conceptId;
                delete from concept_answer where answer_concept = conceptId;
                delete from concept_reference_map where concept_id = conceptId;
                delete from concept where concept_id = conceptId;
            END;
            ]]>
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201405071329" author="mujir" context="rel4">
        <comment>add adt notes data concept set</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            select concept_id INTO @adt_notes_id from concept_name where name='Adt Notes' and locale_preferred = 1;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Adt Notes Data', 'Adt Notes Data', 'N/A', 'Concept Details', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Non-Coded', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Adt', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Notes', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Data', 1);
            set @adt_notes_data_id = @concept_id;
            call add_concept_set_members(@adt_notes_data_id, @adt_notes_id, 0);
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201405081436" author="mujir" context="rel4">
        <comment>remove adt notes data concept set</comment>
        <sql>
            call delete_concept('Adt Notes Data');
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201405061543" author="mujir">
        <comment>Fix delete_concept. deleting concept set membership for the concept to be deleted.</comment>
        <sql>DROP PROCEDURE IF EXISTS delete_concept;</sql>
        <sql  splitStatements="false" stripComments="false">
            <![CDATA[
            CREATE  PROCEDURE delete_concept (name_concept VARCHAR(255))
            BEGIN
            DECLARE conceptId INT default 0;
                select concept_id INTO conceptId from concept_name where name = name_concept and locale_preferred = 1;
                delete from concept_set where concept_set = conceptId;
                delete from concept_set where concept_id = conceptId;
                delete from concept_word where concept_id = conceptId;
                delete from concept_name where concept_id = conceptId;
                delete from concept_numeric where concept_id = conceptId;
                delete from concept_answer where concept_id = conceptId;
                delete from concept_answer where answer_concept = conceptId;
                delete from concept_reference_map where concept_id = conceptId;
                delete from concept where concept_id = conceptId;
            END;
            ]]>
        </sql>
    </changeSet>

    <changeSet id="bahmni-core-201405091936" author="rohan">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="2">
                SELECT COUNT(*) FROM concept_name where name in ('Admit Patient');
            </sqlCheck>
        </preConditions>
        <comment>Change sort weight for Admit Patients.</comment>
        <sql>
            update concept_answer set sort_weight=10 where answer_concept=(select concept_id from concept_name where name='Admit Patient' limit 1);
        </sql>
    </changeSet>

    <changeSet id="bahmni-core-201405110939" author="rohan">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="2">
                SELECT COUNT(*) FROM concept_name where name in ('Discharge Patient');
            </sqlCheck>
        </preConditions>
        <comment>Change sort weight for Discharge Patients.</comment>
        <sql>
            update concept_answer set sort_weight=100 where answer_concept=(select concept_id from concept_name where name='Discharge Patient' limit 1);
        </sql>
    </changeSet>

    <changeSet id="bahmni-core-201405110940" author="rohan">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="2">
                SELECT COUNT(*) FROM concept_name where name in ('Transfer Patient');
            </sqlCheck>
        </preConditions>
        <comment>Change sort weight for Transfer Patients.</comment>
        <sql>
            update concept_answer set sort_weight=200 where answer_concept=(select concept_id from concept_name where name='Transfer Patient' limit 1);
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201405131905" author="Mihir">
        <comment>Add check for voided visits when fetching patients with active visits</comment>
        <sql>
            update global_property set property_value='select distinct concat(pn.given_name," ", pn.family_name) as name, pi.identifier as identifier, concat("",p.uuid) as uuid, concat("",v.uuid) as activeVisitUuid from visit v join person_name pn on v.patient_id = pn.person_id and pn.voided = 0 join patient_identifier pi on v.patient_id = pi.patient_id join person p on p.person_id = v.patient_id where v.date_stopped is null and v.voided=0' where property='emrapi.sqlSearch.activePatients';
            update global_property set property_value='select distinct concat(pn.given_name," ", pn.family_name) as name, pi.identifier as identifier, concat("",p.uuid) as uuid, concat("",v.uuid) as activeVisitUuid from visit v join person_name pn on v.patient_id = pn.person_id and pn.voided = 0 join patient_identifier pi on v.patient_id = pi.patient_id join person p on v.patient_id = p.person_id join encounter e on v.visit_id = e.visit_id join obs o on e.encounter_id = o.encounter_id join concept c on o.value_coded = c.concept_id join concept_name cn on c.concept_id = cn.concept_id where v.date_stopped is null and cn.name = "Admit Patient" and v.voided=0 and v.visit_id not in (select visit_id from encounter ie join encounter_type iet on iet.encounter_type_id = ie.encounter_type where iet.name = "ADMISSION")' where property='emrapi.sqlSearch.patientsToAdmit';
            update global_property set property_value='select distinct concat(pn.given_name," ",pn.family_name) as name, pi.identifier as identifier, concat("",p.uuid) as uuid, concat("",v.uuid) as activeVisitUuid from visit v inner join person_name pn on v.patient_id = pn.person_id and pn.voided = 0 inner join patient_identifier pi on v.patient_id = pi.patient_id inner join person p on v.patient_id = p.person_id inner join encounter e on v.visit_id = e.visit_id inner join obs o on e.encounter_id = o.encounter_id inner join concept c on o.value_coded = c.concept_id inner join concept_name cn on c.concept_id = cn.concept_id left outer join encounter e1 on e1.visit_id = v.visit_id and e1.encounter_type = (select encounter_type_id from encounter_type where name = "DISCHARGE") where v.date_stopped is null and v.voided=0 and cn.name = "Discharge Patient" and e1.encounter_id is null' where property='emrapi.sqlSearch.patientsToDischarge';
            update global_property set property_value='select distinct concat(pn.given_name, " ", pn.family_name) as name, pi.identifier as identifier, concat("",p.uuid) as uuid, concat("",v.uuid) as activeVisitUuid from visit v join person_name pn on v.patient_id = pn.person_id and pn.voided = 0 join patient_identifier pi on v.patient_id = pi.patient_id join person p on p.person_id = v.patient_id join orders on orders.patient_id = v.patient_id join order_type on orders.order_type_id = order_type.order_type_id and order_type.name != "Lab Order" and order_type.name != "Drug Order" where v.date_stopped is null and v.voided=0 and order_id not in(select obs.order_id from obs where person_id = pn.person_id and order_id = orders.order_id)' where property='emrapi.sqlSearch.patientsHasPendingOrders';
            update global_property set property_value='select distinct concat(pn.given_name," ", pn.family_name) as name, pi.identifier as identifier, concat("",p.uuid) as uuid, concat("",v.uuid) as activeVisitUuid from encounter e join visit v on e.visit_id = v.visit_id join person_name pn on v.patient_id = pn.person_id and pn.voided = 0 join patient_identifier pi on v.patient_id = pi.patient_id join person p on v.patient_id = p.person_id join encounter_type et on et.encounter_type_id = e.encounter_type where v.date_stopped is null and v.voided=0 and et.name = "ADMISSION"' where property='emrapi.sqlSearch.admittedPatients';
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201405161709" author="d3" context="rel4">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="1">select count(*) from global_property where property='webservices.rest.maxResultsAbsolute'</sqlCheck>
        </preConditions>
        <comment>Update webservices.rest.maxResultsAbsolute to 1000</comment>
        <sql>
            update global_property set property_value='1000' where property='webservices.rest.maxResultsAbsolute';
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201405211239" author="d3" context="rel4">
        <comment>Add global property bahmni.cacheHeadersFilter.expiresDuration</comment>
        <sql>
            INSERT INTO global_property(`property`, `property_value`, `description`, `uuid`)
            VALUES ('bahmni.cacheHeadersFilter.expiresDuration', '0', 'Expires duration in minutes', '672dc790-e0b6-11e3-8b68-0800200c9a66')
            ON DUPLICATE KEY UPDATE property_value = '0';
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201405231142" author="rt" context="rel4">
        <comment>Update global property emrapi.sqlSearch.admittedPatients</comment>
        <sql>
            update global_property set property_value='select distinct concat(pn.given_name,\' \', pn.family_name) as name, pi.identifier as identifier, concat("",p.uuid) as uuid, concat("",v.uuid) as activeVisitUuid from encounter e join visit v on e.visit_id = v.visit_id join person_name pn on v.patient_id = pn.person_id and pn.voided = 0 join patient_identifier pi on v.patient_id = pi.patient_id join person p on v.patient_id = p.person_id join encounter_type et on et.encounter_type_id = e.encounter_type where v.date_stopped is null and et.name = \'ADMISSION\' and v.voided=0 and e.patient_id not in (select distinct enc.patient_id from encounter enc join encounter_type ent on enc.encounter_type = ent.encounter_type_id where ent.name = \'DISCHARGE\' and enc.patient_id = v.patient_id and enc.visit_id = v.visit_id)' where property='emrapi.sqlSearch.admittedPatients';
        </sql>
    </changeSet>
		<changeSet id="bahmni-core-201406161343" author="Bharti, Rohan">
			<comment>Update the global property for sql to get To Admit patients</comment>
			<sql>
				update global_property set property_value='select distinct concat(pn.given_name," ", pn.family_name) as name, pi.identifier as identifier, concat("",p.uuid) as uuid, concat("",v.uuid) as activeVisitUuid from visit v join person_name pn on v.patient_id = pn.person_id and pn.voided = 0 join patient_identifier pi on v.patient_id = pi.patient_id join person p on v.patient_id = p.person_id join encounter e on v.visit_id = e.visit_id join obs o on e.encounter_id = o.encounter_id join concept c on o.value_coded = c.concept_id join concept_name cn on c.concept_id = cn.concept_id where v.date_stopped is null and cn.name = "Admit Patient" and v.voided=0 and o.voided=0 and v.visit_id not in (select visit_id from encounter ie join encounter_type iet on iet.encounter_type_id = ie.encounter_type where iet.name = "ADMISSION")' where property='emrapi.sqlSearch.patientsToAdmit';
			</sql>
		</changeSet>
		<changeSet id="bahmni-core-201406161345" author="Bharti, Rohan">
			<comment>Update the global property for sql to get To Discharge patients</comment>
			<sql>
			  update global_property set property_value='select distinct concat(pn.given_name," ",pn.family_name) as name, pi.identifier as identifier, concat("",p.uuid) as uuid, concat("",v.uuid) as activeVisitUuid from visit v inner join person_name pn on v.patient_id = pn.person_id and pn.voided = 0 inner join patient_identifier pi on v.patient_id = pi.patient_id inner join person p on v.patient_id = p.person_id inner join encounter e on v.visit_id = e.visit_id inner join obs o on e.encounter_id = o.encounter_id inner join concept c on o.value_coded = c.concept_id inner join concept_name cn on c.concept_id = cn.concept_id left outer join encounter e1 on e1.visit_id = v.visit_id and e1.encounter_type = (select encounter_type_id from encounter_type where name = "DISCHARGE") where v.date_stopped is null and v.voided=0 and o.voided=0 and cn.name = "Discharge Patient" and e1.encounter_id is null' where property='emrapi.sqlSearch.patientsToDischarge';
			</sql>
		</changeSet>
    <changeSet id="bahmni-core-201407011716" author="Crude Oil with our names">
        <comment>Add person name for lab and billing system users</comment>
        <sql>
            set @uuid = '';
            select uuid() into @uuid;
            insert into person_name (preferred, person_id,given_name, family_name, creator,uuid, date_created)
            select true, person_id, 'Lab', 'System', 1, @uuid, now() from users where username =  'Lab System';

            select uuid() into @uuid;
            insert into person_name (preferred, person_id,given_name, family_name, creator,uuid, date_created)
            select true, person_id, 'Billing', 'System', 1, @uuid, now() from users where username =  'Billing System';
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201407141716" author="vinay">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM privilege where privilege = 'Get Order Frequencies';
            </sqlCheck>
        </preConditions>
        <comment>New privileges added</comment>
        <sql>
            set @uuid = '';
            select uuid() into @uuid;
            INSERT INTO `privilege` (`privilege`,`description`,`uuid`) VALUES ('Get Order Frequencies','Able to get Order Frequencies',@uuid);
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201407141717" author="vinay">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM privilege where privilege = 'Manage Order Frequencies';
            </sqlCheck>
        </preConditions>
        <comment>New privileges added</comment>
        <sql>
            set @uuid = '';
            select uuid() into @uuid;
            INSERT INTO `privilege` (`privilege`,`description`,`uuid`) VALUES ('Manage Order Frequencies','Able to add/edit/retire Order Frequencies',@uuid);
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201407141718" author="vinay">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM privilege where privilege = 'Get Care Settings';
            </sqlCheck>
        </preConditions>
        <comment>New privileges added</comment>
        <sql>
            set @uuid = '';
            select uuid() into @uuid;
            INSERT INTO `privilege` (`privilege`,`description`,`uuid`) VALUES ('Get Care Settings','Able to get Care Settings',@uuid);
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201407161230" author="Rohan,Indraneel">
        <comment>Global property pointing to the new encounter provider only session matcher</comment>
        <sql>
            insert into global_property
                (`property`,
                `property_value`,
                `description`,
                `uuid`)
            values
                ('emr.encounterProviderMatcher',
                'org.bahmni.module.bahmnicore.matcher.EncounterProviderSessionMatcher',
                'Encountersession matcher which considers only encounter type and provider',
                uuid());
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201407161630" author="Vinay">
        <comment>Set dosing type and dosing instructions</comment>
        <sql>
            update drug_order
            inner join drug on drug_order.drug_inventory_id = drug.drug_id
            inner join concept_name on drug.dosage_form = concept_name.concept_id and
            concept_name.concept_name_type = 'FULLY_SPECIFIED'
            set drug_order.dosing_instructions = concat(drug_order.dose, ' ', concept_name.name),
            drug_order.dosing_type = 'FREE_TEXT';
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201407171606" author="Rohan, D3">
        <comment>add concept class Image</comment>
        <insert tableName="concept_class">
            <column name="name" value="Image"/>
            <column name="description" value="Image class"/>
            <column name="creator" value="1"/>
            <column name="date_created" valueComputed="curdate()"/>
            <column name="retired" value="0"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>
    <changeSet id="bahmni-core-201407180800" author="Shruthi">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM concept_class where name = 'Computed';
            </sqlCheck>
        </preConditions>
        <comment>add concept class Computed</comment>
        <insert tableName="concept_class">
            <column name="name" value="Computed"/>
            <column name="description" value="Computed"/>
            <column name="creator" value="1"/>
            <column name="date_created" valueComputed="curdate()"/>
            <column name="retired" value="0"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>
    <changeSet id="bahmni-core-201407221627" author="Rohan, Shruthi">
        <preConditions>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM global_property where property = 'emr.encounterMatcher'
            </sqlCheck>
        </preConditions>
        <comment>Update custom encounter session matcher</comment>
        <sql>
            update global_property set property_value='org.openmrs.module.bahmniemrapi.encountertransaction.matcher.EncounterSessionMatcher' where property='emr.encounterMatcher' ;
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201407221628" author="Rohan, Shruthi">
        <preConditions>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM global_property where property = 'emr.encounterProviderMatcher'
            </sqlCheck>
        </preConditions>
        <comment>Update custom encounter session matcher</comment>
        <sql>
            update global_property set property_value='org.openmrs.module.bahmniemrapi.encountertransaction.matcher.EncounterProviderSessionMatcher' where property='emr.encounterProviderMatcher';
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201407251510" author="D3">
        <comment>Set quantity for drug orders without this data</comment>
        <sql>
            UPDATE drug_order
            JOIN orders on drug_order.order_id = orders.order_id
            SET quantity = (datediff(auto_expire_date, start_date) * dose)
            WHERE quantity IS NULL;
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201407251511" author="D3">
        <comment>Set num_refills for drug orders without this data</comment>
        <sql>
            UPDATE drug_order
            SET num_refills = 0
            WHERE num_refills IS NULL;
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201407171215" author="Vinay,Indraneel">
        <comment>Adding concepts and concept set related to dosing units </comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;
            set @concept_set_uuid='';
            set @uuid = '';

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Dosing Units', 'dosing  units', 'N/A', 'ConvSet', true);
            set @set_concept_id = @concept_id;
            call add_concept_word(@concept_id, @concept_name_full_id, 'DOSING', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'DOSING', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'UNITS', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'UNITS', '1');

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Capsule', 'capsule', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'CAPSULE', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'CAPSULE', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Tablet', 'tablet', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'TABLET', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'TABLET', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Teaspoon', 'teaspoon', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'TEASPOON', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'TEASPOON', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Tablespoon', 'tablespoon', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'TABLESPOON', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'TABLESPOON', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Drop', 'drop', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'DROP', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'DROP', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'ml', 'ml', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'ML', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'ML', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'mg', 'mg', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'MG', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'MG', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,1);

            select c.uuid from concept_name cn inner join concept c on cn.concept_id = c.concept_id where cn.name = 'Dosing Units' and cn.concept_name_type = 'FULLY_SPECIFIED' into @concept_set_uuid;
            select uuid() into @uuid;

            insert into global_property
            (`property`,
            `property_value`,
            `description`,
            `uuid`)
            values
            ('order.drugDosingUnitsConceptUuid',
            @concept_set_uuid,
            'Global property pointing to dosing units concept set',
            @uuid)
            ON DUPLICATE KEY UPDATE
            `property_value`=@concept_set_uuid;
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201407171300" author="Vinay, Indraneel">
        <comment>Add drug routes and set global property</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;
            set @uuid = '';

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Drug Routes', 'drug routes', 'N/A', 'ConvSet', true);
            set @set_concept_id = @concept_id;
            call add_concept_word(@concept_id, @concept_name_full_id, 'DRUG', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'DRUG', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'ROUTES', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'ROUTES', '1');

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Intramuscular', 'IM', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'INTRAMUSCULAR', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'INTRAMUSCULAR', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Intravenous', 'IV', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'INTRAVENOUS', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'INTRAVENOUS', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Per Os', 'PO', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'PER', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'OS', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'PO', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Per Vaginal', 'PV', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'PER', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'VAGINAL', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'PV', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Sub Cutaneous', 'SC', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'SUB', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'CUTANEOUS', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'SC', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Per Rectum', 'PR', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'PER', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'RECTUM', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'PR', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Sub Lingual', 'SL', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'SUB', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'LINGUAL', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'SL', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Percutaneous Endoscopic Gastrostomy', 'PEG', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'Percutaneous', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'Endoscopic', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'Gastrostomy', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'PEG', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Nasogastric', 'NG', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'Nasogastric', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'NG', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,1);

            select c.uuid from concept_name cn inner join concept c on cn.concept_id = c.concept_id where cn.name = 'Drug Routes' and cn.concept_name_type = 'FULLY_SPECIFIED' into @concept_set_uuid;
            select uuid() into @uuid;

            insert into global_property
            (`property`,
            `property_value`,
            `description`,
            `uuid`)
            values
            ('order.drugRoutesConceptUuid',
            @concept_set_uuid,
            'Global property pointing to drug routes concept set',
            @uuid)
            ON DUPLICATE KEY UPDATE
            `property_value`=@concept_set_uuid;
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201407171700" author="Vinay, Indraneel">
        <comment>Adding duration unit concepts and setting up associated global property</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Duration Units', 'duration units', 'N/A', 'ConvSet', true);
            set @set_concept_id = @concept_id;
            call add_concept_word(@concept_id, @concept_name_full_id, 'Duration', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'duration', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'Units', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'units', '1');

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Days', 'days', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'Days', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'days', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,1);

            select c.uuid from concept_name cn inner join concept c on cn.concept_id = c.concept_id where cn.name = 'Duration Units' and cn.concept_name_type = 'FULLY_SPECIFIED' into @concept_set_uuid;
            select uuid() into @uuid;

            insert into global_property
            (`property`,
            `property_value`,
            `description`,
            `uuid`)
            values
            ('order.durationUnitsConceptUuid',
            @concept_set_uuid,
            'Global property pointing to duration units concept set',
            @uuid)
            ON DUPLICATE KEY UPDATE
            `property_value`=@concept_set_uuid;
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201407171715" author="Vinay, Indraneel">
        <comment></comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;
            set @uuid = 0;
            set @now = now();

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Once a day', 'OD', 'N/A', 'Frequency', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'ONCE', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'DAY', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'OD', '1');
            select uuid() into @uuid;
            insert into order_frequency(concept_id, frequency_per_day, creator, date_created, uuid) values(@concept_id, 1, 1, @now, @uuid);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Twice a day', 'BD', 'N/A', 'Frequency', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'TWICE', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'DAY', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'BD', '1');
            select uuid() into @uuid;
            insert into order_frequency(concept_id, frequency_per_day, creator, date_created, uuid) values(@concept_id, 2, 1, @now, @uuid);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Thrice a day', 'TDS', 'N/A', 'Frequency', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'THRICE', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'DAY', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'TDS', '1');
            select uuid() into @uuid;
            insert into order_frequency(concept_id, frequency_per_day, creator, date_created, uuid) values(@concept_id, 3, 1, @now, @uuid);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Four times a day', 'QDS', 'N/A', 'Frequency', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'FOUR', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'TIMES', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'DAY', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'QDS', '1');
            select uuid() into @uuid;
            insert into order_frequency(concept_id, frequency_per_day, creator, date_created, uuid) values(@concept_id, 4, 1, @now, @uuid);
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201407291254" author="Vinay, Deepak">
        <comment></comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Dosing Instructions', 'Dosing Instructions', 'N/A', 'ConvSet', true);
            set @set_concept_id = @concept_id;
            call add_concept_word(@concept_id, @concept_name_full_id, 'Dosing', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'Instructions', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'Dosing', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'Instructions', '1');

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Before meals', 'ac', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'Before', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'meals', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'ac', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,1);


            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Empty stomach', '', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'Empty', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'stomach', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,2);


            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'After meals', 'pc', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'After', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'meals', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'pc', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,3);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'In the morning', 'cm', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'morning', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'cm', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,4);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'In the evening', '', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'evening', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,5);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'At bedtime', 'hs', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'bedtime', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'hs', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,6);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Immediately', 'STAT', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'Immediately', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'STAT', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,7);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'As directed', '', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_full_id, 'directed', '1');
            call add_concept_set_members (@set_concept_id,@concept_id,8);

            select c.uuid from concept_name cn inner join concept c on cn.concept_id = c.concept_id where cn.name = 'Dosing Instructions' and cn.concept_name_type = 'FULLY_SPECIFIED' into @concept_set_uuid;
            select uuid() into @uuid;

            insert into global_property
            (`property`,
            `property_value`,
            `description`,
            `uuid`)
            values
            ('order.dosingInstructionsConceptUuid',
            @concept_set_uuid,
            'Global property pointing to duration units concept set',
            @uuid)
            ON DUPLICATE KEY UPDATE
            `property_value`=@concept_set_uuid;
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201408111300" author="Indraneel" >
        <comment>Adding all templates concept set of sets</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'All Observation Templates', 'All Observation templates', 'N/A', 'ConvSet', true);
            set @set_concept_id = @concept_id;
            call add_concept_word(@concept_id, @concept_name_full_id, 'ALL', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'OBSERVATION', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'TEMPLATES', '1');

            call add_concept_word(@concept_id, @concept_name_short_id, 'ALL', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'OBSERVATION', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'TEMPLATES', '1');
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-20140814132600" author="Rohan, Vinay" >
        <comment>Update Dosing type from ENUM to Class Name</comment>
        <sql>
            update drug_order set dosing_type='org.openmrs.FreeTextDosingInstructions' where dosing_type='FREE_TEXT';
            update drug_order set dosing_type='org.openmrs.SimpleDosingInstructions' where dosing_type='SIMPLE';
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201408130010" author="Mujir">
        <createTable tableName="import_status" >
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="import_status_pk" nullable="false" />
            </column>

            <!-- Should the file name columns be text?? -->
            <column name="original_file_name" type="varchar(500)">
                <constraints nullable="false"/>
            </column>
            <column name="saved_file_name" type="varchar(500)" >
                <!--<constraints nullable="false" unique="true"/>-->
                <constraints nullable="false" />
            </column>
            <column name="error_file_name" type="varchar(500)"/>
            <column name="type" type="varchar(25)">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="varchar(25)">
                <constraints nullable="false"/>
            </column>
            <column name="successful_records" type="numeric(6)"/>
            <column name="failed_records" type="numeric(6)"/>
            <column name="stage_name" type="varchar(10)" />
            <column name="stack_trace" type="text" />

            <column name="uploaded_by" type="varchar(20)">
                <constraints nullable="false"/>
            </column>
            <column name="start_time" type="timestamp"/>
            <column name="end_time" type="timestamp"/>
        </createTable>
    </changeSet>
    <changeSet id="bahmni-core-201408180936" author="Mujir, Mihir">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM global_property where property = 'uploaded.files.directory'
            </sqlCheck>
        </preConditions>
        <comment>Add directory for imported files</comment>
        <sql>
            insert into global_property (`property`, `property_value`, `description`, `uuid`)
            values ('uploaded.files.directory', '/home/bahmni/uploaded-files/mrs/', 'Directory where files uploaded to Bahmni are stored', uuid());
        </sql>
    </changeSet>

    <changeSet id="bahmni-clinical-201408251220" author="D3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from privilege where privilege = 'app:admin'</sqlCheck>
        </preConditions>
        <insert tableName="privilege">
            <column name="privilege" value="app:admin"/>
            <column name="description" value="Bahmni admin app access privilege"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>

    <changeSet id="bahmni-core-201408251455" author="Rohan">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM concept_class where name = 'URL';
            </sqlCheck>
        </preConditions>
        <comment>add concept class URL</comment>
        <insert tableName="concept_class">
            <column name="name" value="URL"/>
            <column name="description" value="URL"/>
            <column name="creator" value="1"/>
            <column name="date_created" valueComputed="curdate()"/>
            <column name="retired" value="0"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>
    <changeSet id="bahmni-core-201408251456" author="Rohan">
        <comment>Add new concept LAB REPORT for uploaded file</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;
            set @labresults_concept_id = 0;

            set @answer_concept_id = 0;
            call add_concept(@concept_id, @concept_name_short_id,
            @concept_name_full_id,'LAB_REPORT','LAB_REPORT', 'Text', 'URL', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'LAB', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'REPORT', 1);
            select @labresults_concept_id := concept_id, min(concept_id) from concept_name where name = 'LABRESULTS_CONCEPT';
            set @set_concept_id = @concept_id;
            call add_concept_set_members (@labresults_concept_id,@set_concept_id,1);
        </sql>
    </changeSet>
    <changeSet id="bahmni-core-201409041224" author="Banka">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT count(*) from role_privilege where role='Anonymous' and privilege='View Locations'</sqlCheck>
        </preConditions>
        <comment>Add View Location privilege to Anonymous</comment>
        <insert tableName="role_privilege">
            <column name="role" value="Anonymous"/>
            <column name="privilege" value="View Locations"/>
        </insert>
    </changeSet>
    <changeSet id="bahmni-core-201409091224" author="Mihir, Shruthi">
        <comment>Removing global property for encounter provider matcher</comment>
        <sql>
            delete from global_property where property='emr.encounterProviderMatcher';
        </sql>
    </changeSet>
</databaseChangeLog>